import serial
import time
import firebase_admin
from firebase_admin import credentials, db

# Firebase 인증 및 앱 초기화
cred = credentials.Certificate('/path/to/your/firebase-adminsdk.json')  # JSON 파일 경로
firebase_admin.initialize_app(cred, {
    'databaseURL': 'https://your-database-name.firebaseio.com/'  # Firebase 데이터베이스 URL
})

# 시리얼 포트 설정 (예시: /dev/ttyACM0)
ser = serial.Serial('/dev/ttyACM0', 9600, timeout=1)
time.sleep(2)  # 포트 안정화 대기

try:
    while True:
        # 아두이노로부터 데이터 수신
        receivedData = ser.readline().decode('utf-8').rstrip()
        if receivedData:
            print(f"Received from Arduino: {receivedData}")
            
            # Firebase에 데이터 전송
            ref = db.reference('sensorData')
            ref.push({
                'timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
                'value': receivedData
            })
            print("Data sent to Firebase")
        
        time.sleep(1)

except KeyboardInterrupt:
    print("Program interrupted")

finally:
    ser.close()  # 시리얼 포트 닫기
